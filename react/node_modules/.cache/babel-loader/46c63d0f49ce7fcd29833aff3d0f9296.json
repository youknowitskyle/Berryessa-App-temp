{"ast":null,"code":"import _defineProperty from \"C:\\\\Users\\\\moonl\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _objectWithoutProperties from \"C:\\\\Users\\\\moonl\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectWithoutProperties\";\nvar _jsxFileName = \"C:\\\\Users\\\\moonl\\\\Documents\\\\GitHub\\\\Berryessa-App\\\\react\\\\src\\\\components\\\\Prayer\\\\index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { Component } from \"react\";\nimport Popup from \"reactjs-popup\"; //import styles from \"./styles.css\";\n\nimport { AuthUserContext, withAuthorization } from \"../Session\";\nimport { withFirebase } from \"../Firebase\";\nimport Replies from \"./reply\";\nimport * as ROLES from \"../../constants/roles\";\n\nconst PrayerPage = () => React.createElement(\"div\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 13\n  },\n  __self: this\n}, React.createElement(\"h1\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 14\n  },\n  __self: this\n}, \"Prayer Requests\"), React.createElement(\"p\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 15\n  },\n  __self: this\n}, \"If you need prayer for anything, please submit your request below.\"), React.createElement(Prayers, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 16\n  },\n  __self: this\n}));\n\nclass PrayersBase extends Component {\n  constructor(props) {\n    super(props);\n\n    this.onChangeText = event => {\n      this.setState({\n        text: event.target.value\n      });\n    };\n\n    this.onChangeCheckbox = event => {\n      this.setState({\n        [event.target.name]: event.target.checked\n      });\n    };\n\n    this.onCreatePrayer = (event, authUser) => {\n      this.props.firebase.prayers().push({\n        text: this.state.text,\n        userId: authUser.uid,\n        username: authUser.username,\n        isAnonymous: this.state.isAnonymous,\n        createdAt: this.props.firebase.serverValue.TIMESTAMP\n      });\n      this.setState({\n        text: \"\"\n      });\n      event.preventDefault();\n    };\n\n    this.onEditPrayer = (prayer, text) => {\n      const uid = prayer.uid,\n            prayerSnapshot = _objectWithoutProperties(prayer, [\"uid\"]);\n\n      this.props.firebase.prayer(prayer.uid).set(_objectSpread({}, prayerSnapshot, {\n        text,\n        editedAt: this.props.firebase.serverValue.TIMESTAMP\n      }));\n    };\n\n    this.onRemovePrayer = uid => {\n      this.props.firebase.prayer(uid).remove();\n    };\n\n    this.onNextPage = () => {\n      this.setState(state => ({\n        limit: state.limit + 5\n      }), this.onListenForPrayers);\n    };\n\n    this.state = {\n      text: \"\",\n      isAnonymous: false,\n      loading: false,\n      prayers: [],\n      limit: 5,\n      reply: null //becomes id of message\n\n    };\n  }\n\n  componentDidMount() {\n    this.onListenForPrayers();\n  }\n\n  onListenForPrayers() {\n    this.setState({\n      loading: true\n    });\n    this.props.firebase.prayers().orderByChild(\"createdAt\").limitToLast(this.state.limit).on(\"value\", snapshot => {\n      const prayerObject = snapshot.val();\n\n      if (prayerObject) {\n        const prayerList = Object.keys(prayerObject).map(key => _objectSpread({}, prayerObject[key], {\n          uid: key\n        })); // convert prayers list from snapshot\n\n        this.setState({\n          prayers: prayerList,\n          loading: false\n        });\n      } else {\n        this.setState({\n          prayers: null,\n          loading: false\n        });\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this.props.firebase.prayers().off();\n  }\n\n  render() {\n    const _this$state = this.state,\n          text = _this$state.text,\n          isAnonymous = _this$state.isAnonymous,\n          prayers = _this$state.prayers,\n          loading = _this$state.loading;\n    const isInvalid = text === \"\";\n    return React.createElement(AuthUserContext.Consumer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }, authUser => React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }, !loading && prayers && React.createElement(\"button\", {\n      type: \"button\",\n      onClick: this.onNextPage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123\n      },\n      __self: this\n    }, \"More\"), loading && React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128\n      },\n      __self: this\n    }, \"Loading ...\"), prayers ? React.createElement(PrayerList, {\n      authUser: authUser,\n      prayers: prayers,\n      onEditPrayer: this.onEditPrayer,\n      onRemovePrayer: this.onRemovePrayer,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138\n      },\n      __self: this\n    }, \"There are no prayer requests ...\"), React.createElement(\"form\", {\n      onSubmit: event => this.onCreatePrayer(event, authUser),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      name: \"prayer\",\n      type: \"text\",\n      value: text,\n      onChange: this.onChangeText,\n      placeholder: \"Send a prayer request...\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }), React.createElement(\"label\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    }, \"Send Anonymously:\", \" \", React.createElement(\"input\", {\n      name: \"isAnonymous\",\n      type: \"checkbox\",\n      checked: isAnonymous,\n      onChange: this.onChangeCheckbox,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151\n      },\n      __self: this\n    }), \" \"), React.createElement(\"button\", {\n      disabled: isInvalid,\n      type: \"submit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158\n      },\n      __self: this\n    }, \"Send\"))));\n  }\n\n}\n\nconst PrayerList = ({\n  authUser,\n  prayers,\n  onEditPrayer,\n  onRemovePrayer\n}) => React.createElement(\"ul\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 170\n  },\n  __self: this\n}, prayers.map(prayer => (authUser.uid === prayer.userId || !!authUser.roles[ROLES.ADMIN] || !!authUser.roles[ROLES.MODERATOR]) && React.createElement(PrayerItem, {\n  authUser: authUser,\n  key: prayer.uid,\n  prayer: prayer,\n  onEditPrayer: onEditPrayer,\n  onRemovePrayer: onRemovePrayer,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 176\n  },\n  __self: this\n})));\n\nclass PrayerItem extends Component {\n  constructor(props) {\n    super(props);\n\n    this.onToggleEditMode = () => {\n      this.setState(state => ({\n        editMode: !state.editMode,\n        editText: this.props.prayer.text\n      }));\n    };\n\n    this.onChangeEditText = event => {\n      this.setState({\n        editText: event.target.value\n      });\n    };\n\n    this.onSaveEditText = () => {\n      this.props.onEditPrayer(this.props.prayer, this.state.editText);\n      this.setState({\n        editMode: false\n      });\n    };\n\n    this.state = {\n      editMode: false,\n      editText: this.props.prayer.text\n    };\n  }\n\n  render() {\n    const _this$props = this.props,\n          authUser = _this$props.authUser,\n          prayer = _this$props.prayer,\n          onRemovePrayer = _this$props.onRemovePrayer;\n    const _this$state2 = this.state,\n          editMode = _this$state2.editMode,\n          editText = _this$state2.editText;\n    const isInvalid = editText === \"\";\n    return React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222\n      },\n      __self: this\n    }, editMode ? React.createElement(\"input\", {\n      type: \"text\",\n      value: editText,\n      onChange: this.onChangeEditText,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224\n      },\n      __self: this\n    }) : React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230\n      },\n      __self: this\n    }, React.createElement(\"strong\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    }, prayer.isAnonymous ? \"Anonymous\" : prayer.username, \":\", \" \"), prayer.text, prayer.editedAt && React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235\n      },\n      __self: this\n    }, \"(Edited)\")), authUser.uid === prayer.userId && React.createElement(Popup, {\n      trigger: open => React.createElement(\"button\", {\n        className: \"button\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }, open ? \"Close\" : \":\"),\n      position: \"right top\",\n      closeOnDocumentClick: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239\n      },\n      __self: this\n    }, editMode ? React.createElement(\"span\", {\n      className: \"card\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      className: \"menu-item\",\n      type: \"button\",\n      disabled: isInvalid,\n      onClick: this.onSaveEditText,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248\n      },\n      __self: this\n    }, \"Save\"), React.createElement(\"button\", {\n      className: \"menu-item\",\n      type: \"button\",\n      onClick: this.onToggleEditMode,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256\n      },\n      __self: this\n    }, \"Reset\")) : React.createElement(\"span\", {\n      className: \"card\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      className: \"menu-item\",\n      type: \"button\",\n      onClick: this.onToggleEditMode,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266\n      },\n      __self: this\n    }, \"Edit\"), React.createElement(\"button\", {\n      className: \"menu-item\",\n      type: \"button\",\n      onClick: () => onRemovePrayer(prayer.uid),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273\n      },\n      __self: this\n    }, \"Delete\"))), React.createElement(Popup, {\n      trigger: React.createElement(\"button\", {\n        className: \"button\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285\n        },\n        __self: this\n      }, \"Reply\"),\n      modal: true,\n      closeOnDocumentClick: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290\n      },\n      __self: this\n    }, \"User: \", prayer.isAnonymous ? \"Anonymous\" : prayer.username), React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 293\n      },\n      __self: this\n    }, prayer.text), React.createElement(Replies, {\n      prayer: prayer,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 294\n      },\n      __self: this\n    }))));\n  }\n\n}\n\nconst Prayers = withFirebase(PrayersBase);\n\nconst condition = authUser => !!authUser && (!!authUser.roles[ROLES.ADMIN] || !!authUser.roles[ROLES.MODERATOR] || !!authUser.roles[ROLES.APPROVED]); //or equivalently:\n//const condition = authUser => authUser != null;\n\n\nexport default withAuthorization(condition)(PrayerPage);","map":{"version":3,"sources":["C:\\Users\\moonl\\Documents\\GitHub\\Berryessa-App\\react\\src\\components\\Prayer\\index.js"],"names":["React","Component","Popup","AuthUserContext","withAuthorization","withFirebase","Replies","ROLES","PrayerPage","PrayersBase","constructor","props","onChangeText","event","setState","text","target","value","onChangeCheckbox","name","checked","onCreatePrayer","authUser","firebase","prayers","push","state","userId","uid","username","isAnonymous","createdAt","serverValue","TIMESTAMP","preventDefault","onEditPrayer","prayer","prayerSnapshot","set","editedAt","onRemovePrayer","remove","onNextPage","limit","onListenForPrayers","loading","reply","componentDidMount","orderByChild","limitToLast","on","snapshot","prayerObject","val","prayerList","Object","keys","map","key","componentWillUnmount","off","render","isInvalid","PrayerList","roles","ADMIN","MODERATOR","PrayerItem","onToggleEditMode","editMode","editText","onChangeEditText","onSaveEditText","open","Prayers","condition","APPROVED"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport Popup from \"reactjs-popup\";\r\n\r\n//import styles from \"./styles.css\";\r\n\r\nimport { AuthUserContext, withAuthorization } from \"../Session\";\r\nimport { withFirebase } from \"../Firebase\";\r\nimport Replies from \"./reply\";\r\n\r\nimport * as ROLES from \"../../constants/roles\";\r\n\r\nconst PrayerPage = () => (\r\n  <div>\r\n    <h1>Prayer Requests</h1>\r\n    <p>If you need prayer for anything, please submit your request below.</p>\r\n    <Prayers />\r\n  </div>\r\n);\r\n\r\nclass PrayersBase extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      text: \"\",\r\n      isAnonymous: false,\r\n      loading: false,\r\n      prayers: [],\r\n      limit: 5,\r\n      reply: null //becomes id of message\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.onListenForPrayers();\r\n  }\r\n\r\n  onListenForPrayers() {\r\n    this.setState({ loading: true });\r\n\r\n    this.props.firebase\r\n      .prayers()\r\n      .orderByChild(\"createdAt\")\r\n      .limitToLast(this.state.limit)\r\n      .on(\"value\", snapshot => {\r\n        const prayerObject = snapshot.val();\r\n\r\n        if (prayerObject) {\r\n          const prayerList = Object.keys(prayerObject).map(key => ({\r\n            ...prayerObject[key],\r\n            uid: key\r\n          }));\r\n          // convert prayers list from snapshot\r\n\r\n          this.setState({\r\n            prayers: prayerList,\r\n            loading: false\r\n          });\r\n        } else {\r\n          this.setState({ prayers: null, loading: false });\r\n        }\r\n      });\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.props.firebase.prayers().off();\r\n  }\r\n\r\n  onChangeText = event => {\r\n    this.setState({ text: event.target.value });\r\n  };\r\n\r\n  onChangeCheckbox = event => {\r\n    this.setState({ [event.target.name]: event.target.checked });\r\n  };\r\n\r\n  onCreatePrayer = (event, authUser) => {\r\n    this.props.firebase.prayers().push({\r\n      text: this.state.text,\r\n      userId: authUser.uid,\r\n      username: authUser.username,\r\n      isAnonymous: this.state.isAnonymous,\r\n      createdAt: this.props.firebase.serverValue.TIMESTAMP\r\n    });\r\n\r\n    this.setState({ text: \"\" });\r\n\r\n    event.preventDefault();\r\n  };\r\n\r\n  onEditPrayer = (prayer, text) => {\r\n    const { uid, ...prayerSnapshot } = prayer;\r\n\r\n    this.props.firebase.prayer(prayer.uid).set({\r\n      ...prayerSnapshot,\r\n      text,\r\n      editedAt: this.props.firebase.serverValue.TIMESTAMP\r\n    });\r\n  };\r\n\r\n  onRemovePrayer = uid => {\r\n    this.props.firebase.prayer(uid).remove();\r\n  };\r\n\r\n  onNextPage = () => {\r\n    this.setState(\r\n      state => ({ limit: state.limit + 5 }),\r\n      this.onListenForPrayers\r\n    );\r\n  };\r\n\r\n  render() {\r\n    const { text, isAnonymous, prayers, loading } = this.state;\r\n\r\n    const isInvalid = text === \"\";\r\n\r\n    return (\r\n      <AuthUserContext.Consumer>\r\n        {authUser => (\r\n          <div>\r\n            {!loading &&\r\n              prayers && (\r\n                <button type=\"button\" onClick={this.onNextPage}>\r\n                  More\r\n                </button>\r\n              )}\r\n\r\n            {loading && <div>Loading ...</div>}\r\n\r\n            {prayers ? (\r\n              <PrayerList\r\n                authUser={authUser}\r\n                prayers={prayers}\r\n                onEditPrayer={this.onEditPrayer}\r\n                onRemovePrayer={this.onRemovePrayer}\r\n              />\r\n            ) : (\r\n              <div>There are no prayer requests ...</div>\r\n            )}\r\n\r\n            <form onSubmit={event => this.onCreatePrayer(event, authUser)}>\r\n              <input\r\n                name=\"prayer\"\r\n                type=\"text\"\r\n                value={text}\r\n                onChange={this.onChangeText}\r\n                placeholder=\"Send a prayer request...\"\r\n              />\r\n              <label>\r\n                Send Anonymously:{\" \"}\r\n                <input\r\n                  name=\"isAnonymous\"\r\n                  type=\"checkbox\"\r\n                  checked={isAnonymous}\r\n                  onChange={this.onChangeCheckbox}\r\n                />{\" \"}\r\n              </label>\r\n              <button disabled={isInvalid} type=\"submit\">\r\n                Send\r\n              </button>\r\n            </form>\r\n          </div>\r\n        )}\r\n      </AuthUserContext.Consumer>\r\n    );\r\n  }\r\n}\r\n\r\nconst PrayerList = ({ authUser, prayers, onEditPrayer, onRemovePrayer }) => (\r\n  <ul>\r\n    {prayers.map(\r\n      prayer =>\r\n        (authUser.uid === prayer.userId ||\r\n          !!authUser.roles[ROLES.ADMIN] ||\r\n          !!authUser.roles[ROLES.MODERATOR]) && (\r\n          <PrayerItem\r\n            authUser={authUser}\r\n            key={prayer.uid}\r\n            prayer={prayer}\r\n            onEditPrayer={onEditPrayer}\r\n            onRemovePrayer={onRemovePrayer}\r\n          />\r\n        )\r\n    )}\r\n  </ul>\r\n);\r\n\r\nclass PrayerItem extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      editMode: false,\r\n      editText: this.props.prayer.text\r\n    };\r\n  }\r\n\r\n  onToggleEditMode = () => {\r\n    this.setState(state => ({\r\n      editMode: !state.editMode,\r\n      editText: this.props.prayer.text\r\n    }));\r\n  };\r\n\r\n  onChangeEditText = event => {\r\n    this.setState({ editText: event.target.value });\r\n  };\r\n\r\n  onSaveEditText = () => {\r\n    this.props.onEditPrayer(this.props.prayer, this.state.editText);\r\n\r\n    this.setState({ editMode: false });\r\n  };\r\n\r\n  render() {\r\n    const { authUser, prayer, onRemovePrayer } = this.props;\r\n    const { editMode, editText } = this.state;\r\n\r\n    const isInvalid = editText === \"\";\r\n\r\n    return (\r\n      <li>\r\n        {editMode ? (\r\n          <input\r\n            type=\"text\"\r\n            value={editText}\r\n            onChange={this.onChangeEditText}\r\n          />\r\n        ) : (\r\n          <span>\r\n            <strong>\r\n              {prayer.isAnonymous ? \"Anonymous\" : prayer.username}:{\" \"}\r\n            </strong>\r\n            {prayer.text}\r\n            {prayer.editedAt && <span>(Edited)</span>}\r\n          </span>\r\n        )}\r\n        {authUser.uid === prayer.userId && (\r\n          <Popup\r\n            trigger={open => (\r\n              <button className=\"button\">{open ? \"Close\" : \":\"}</button>\r\n            )}\r\n            position=\"right top\"\r\n            closeOnDocumentClick\r\n          >\r\n            {editMode ? (\r\n              <span className=\"card\">\r\n                <button\r\n                  className=\"menu-item\"\r\n                  type=\"button\"\r\n                  disabled={isInvalid}\r\n                  onClick={this.onSaveEditText}\r\n                >\r\n                  Save\r\n                </button>\r\n                <button\r\n                  className=\"menu-item\"\r\n                  type=\"button\"\r\n                  onClick={this.onToggleEditMode}\r\n                >\r\n                  Reset\r\n                </button>\r\n              </span>\r\n            ) : (\r\n              <span className=\"card\">\r\n                <button\r\n                  className=\"menu-item\"\r\n                  type=\"button\"\r\n                  onClick={this.onToggleEditMode}\r\n                >\r\n                  Edit\r\n                </button>\r\n                <button\r\n                  className=\"menu-item\"\r\n                  type=\"button\"\r\n                  onClick={() => onRemovePrayer(prayer.uid)}\r\n                >\r\n                  Delete\r\n                </button>\r\n              </span>\r\n            )}\r\n          </Popup>\r\n        )}\r\n        <Popup\r\n          trigger={<button className=\"button\">Reply</button>}\r\n          modal\r\n          closeOnDocumentClick\r\n        >\r\n          <div>\r\n            <span>\r\n              User: {prayer.isAnonymous ? \"Anonymous\" : prayer.username}\r\n            </span>\r\n            <h1>{prayer.text}</h1>\r\n            <Replies prayer={prayer} />\r\n          </div>\r\n        </Popup>\r\n      </li>\r\n    );\r\n  }\r\n}\r\n\r\nconst Prayers = withFirebase(PrayersBase);\r\n\r\nconst condition = authUser =>\r\n  !!authUser &&\r\n  (!!authUser.roles[ROLES.ADMIN] ||\r\n    !!authUser.roles[ROLES.MODERATOR] ||\r\n    !!authUser.roles[ROLES.APPROVED]);\r\n\r\n//or equivalently:\r\n//const condition = authUser => authUser != null;\r\n\r\nexport default withAuthorization(condition)(PrayerPage);\r\n"]},"metadata":{},"sourceType":"module"}