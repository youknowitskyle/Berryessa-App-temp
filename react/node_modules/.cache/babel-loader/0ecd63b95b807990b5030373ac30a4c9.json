{"ast":null,"code":"import _objectSpread from \"/Users/kyle/workspace/Projects/Berryessa-App/react/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _objectWithoutProperties from \"/Users/kyle/workspace/Projects/Berryessa-App/react/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _jsxFileName = \"/Users/kyle/workspace/Projects/Berryessa-App/react/src/components/Prayer/reply.js\";\nimport React, { Component } from \"react\";\nimport { AuthUserContext, withAuthorization } from \"../Session\";\nimport { withFirebase } from \"../Firebase\";\nimport * as ROLES from \"../../constants/roles\";\n\nclass ReplyBase extends Component {\n  constructor(props) {\n    super(props);\n\n    this.onChangeText = event => {\n      this.setState({\n        text: event.target.value\n      });\n    };\n\n    this.onChangeCheckbox = event => {\n      this.setState({\n        [event.target.name]: event.target.checked\n      });\n    };\n\n    this.onCreateReply = (event, authUser) => {\n      this.props.firebase.replies(this.props.prayer.uid).push({\n        text: this.state.text,\n        prayerId: this.props.prayer.uid,\n        userId: authUser.uid,\n        username: authUser.username,\n        isAnonymous: this.state.isAnonymous,\n        createdAt: this.props.firebase.serverValue.TIMESTAMP\n      });\n      this.setState({\n        text: \"\"\n      });\n      event.preventDefault();\n    };\n\n    this.onEditReply = (reply, text) => {\n      const uid = reply.uid,\n            replySnapshot = _objectWithoutProperties(reply, [\"uid\"]);\n\n      this.props.firebase.reply(this.props.prayer.uid)(reply.uid).set(_objectSpread({}, replySnapshot, {\n        text,\n        editedAt: this.props.firebase.serverValue.TIMESTAMP\n      }));\n    };\n\n    this.onRemoveReply = uid => {\n      this.props.firebase.reply(this.props.prayer.uid)(uid).remove();\n    };\n\n    this.onNextPage = () => {\n      this.setState(state => ({\n        limit: state.limit + 5\n      }), this.onListenForReplies);\n    };\n\n    this.state = {\n      text: \"\",\n      isAnonymous: false,\n      loading: false,\n      replies: [],\n      limit: 5\n    };\n  }\n\n  componentDidMount() {\n    this.onListenForReplies();\n  }\n\n  onListenForReplies() {\n    this.setState({\n      loading: true\n    });\n    this.props.firebase.replies(this.props.prayer.uid).orderByChild(\"createdAt\").limitToLast(this.state.limit).on(\"value\", snapshot => {\n      const replyObject = snapshot.val();\n\n      if (replyObject) {\n        const replyList = Object.keys(replyObject).map(key => _objectSpread({}, replyObject[key], {\n          uid: key\n        })); // convert replies list from snapshot\n\n        this.setState({\n          replies: replyList,\n          loading: false\n        });\n      } else {\n        this.setState({\n          replies: null,\n          loading: false\n        });\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this.props.firebase.replies(this.props.prayer.uid).off();\n  }\n\n  render() {\n    const _this$state = this.state,\n          text = _this$state.text,\n          replies = _this$state.replies,\n          loading = _this$state.loading;\n    const isInvalid = text === \"\";\n    return React.createElement(AuthUserContext.Consumer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110\n      },\n      __self: this\n    }, authUser => React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112\n      },\n      __self: this\n    }, !loading && replies && React.createElement(\"button\", {\n      type: \"button\",\n      onClick: this.onNextPage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114\n      },\n      __self: this\n    }, \"More\"), loading && React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119\n      },\n      __self: this\n    }, \"Loading ...\"), replies ? React.createElement(ReplyList, {\n      authUser: authUser,\n      replies: replies,\n      onEditReply: this.onEditReply,\n      onRemoveReply: this.onRemoveReply,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }, \"There are no reply requests ...\"), React.createElement(\"form\", {\n      onSubmit: event => this.onCreateReply(event, authUser),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      name: \"reply\",\n      type: \"text\",\n      value: text,\n      onChange: this.onChangeText,\n      placeholder: \"Send a reply...\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      disabled: isInvalid,\n      type: \"submit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }, \"Send\"))));\n  }\n\n}\n\nconst ReplyList = ({\n  authUser,\n  replies,\n  onEditReply,\n  onRemoveReply\n}) => React.createElement(\"ul\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 152\n  },\n  __self: this\n}, replies.map(reply => (authUser.uid === reply.userId || !!authUser.roles[ROLES.ADMIN] || !!authUser.roles[ROLES.MODERATOR]) && React.createElement(ReplyItem, {\n  authUser: authUser,\n  key: reply.uid,\n  reply: reply,\n  onEditReply: onEditReply,\n  onRemoveReply: onRemoveReply,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 158\n  },\n  __self: this\n})));\n\nclass ReplyItem extends Component {\n  constructor(props) {\n    super(props);\n\n    this.onToggleEditMode = () => {\n      this.setState(state => ({\n        editMode: !state.editMode,\n        editText: this.props.reply.text\n      }));\n    };\n\n    this.onChangeEditText = event => {\n      this.setState({\n        editText: event.target.value\n      });\n    };\n\n    this.onSaveEditText = () => {\n      this.props.onEditReply(this.props.reply, this.state.editText);\n      this.setState({\n        editMode: false\n      });\n    };\n\n    this.state = {\n      editMode: false,\n      editText: this.props.reply.text\n    };\n  }\n\n  render() {\n    const _this$props = this.props,\n          authUser = _this$props.authUser,\n          reply = _this$props.reply,\n          onRemoveReply = _this$props.onRemoveReply;\n    const _this$state2 = this.state,\n          editMode = _this$state2.editMode,\n          editText = _this$state2.editText;\n    const isInvalid = editText === \"\";\n    return React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204\n      },\n      __self: this\n    }, editMode ? React.createElement(\"input\", {\n      type: \"text\",\n      value: editText,\n      onChange: this.onChangeEditText,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206\n      },\n      __self: this\n    }) : React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212\n      },\n      __self: this\n    }, React.createElement(\"strong\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    }, reply.isAnonymous ? \"Anonymous\" : reply.username), \" \", reply.text, console.log(reply), reply.editedAt && React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216\n      },\n      __self: this\n    }, \"(Edited)\")), authUser.uid === reply.userId && React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220\n      },\n      __self: this\n    }, editMode ? React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      disabled: isInvalid,\n      onClick: this.onSaveEditText,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223\n      },\n      __self: this\n    }, \"Save\"), React.createElement(\"button\", {\n      onClick: this.onToggleEditMode,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226\n      },\n      __self: this\n    }, \"Reset\")) : React.createElement(\"button\", {\n      onClick: this.onToggleEditMode,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, \"Edit\"), !editMode && React.createElement(\"button\", {\n      type: \"button\",\n      onClick: () => onRemoveReply(reply.uid),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232\n      },\n      __self: this\n    }, \"Delete\")));\n  }\n\n}\n\nconst Replies = withFirebase(ReplyBase);\n\nconst condition = authUser => !!authUser && (!!authUser.roles[ROLES.ADMIN] || !!authUser.roles[ROLES.MODERATOR] || !!authUser.roles[ROLES.APPROVED]); //or equivalently:\n//const condition = authUser => authUser != null;\n\n\nexport default withAuthorization(condition)(Replies);","map":{"version":3,"sources":["/Users/kyle/workspace/Projects/Berryessa-App/react/src/components/Prayer/reply.js"],"names":["React","Component","AuthUserContext","withAuthorization","withFirebase","ROLES","ReplyBase","constructor","props","onChangeText","event","setState","text","target","value","onChangeCheckbox","name","checked","onCreateReply","authUser","firebase","replies","prayer","uid","push","state","prayerId","userId","username","isAnonymous","createdAt","serverValue","TIMESTAMP","preventDefault","onEditReply","reply","replySnapshot","set","editedAt","onRemoveReply","remove","onNextPage","limit","onListenForReplies","loading","componentDidMount","orderByChild","limitToLast","on","snapshot","replyObject","val","replyList","Object","keys","map","key","componentWillUnmount","off","render","isInvalid","ReplyList","roles","ADMIN","MODERATOR","ReplyItem","onToggleEditMode","editMode","editText","onChangeEditText","onSaveEditText","console","log","Replies","condition","APPROVED"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\n\nimport { AuthUserContext, withAuthorization } from \"../Session\";\nimport { withFirebase } from \"../Firebase\";\n\nimport * as ROLES from \"../../constants/roles\";\n\nclass ReplyBase extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      text: \"\",\n      isAnonymous: false,\n      loading: false,\n      replies: [],\n      limit: 5\n    };\n  }\n\n  componentDidMount() {\n    this.onListenForReplies();\n  }\n\n  onListenForReplies() {\n    this.setState({ loading: true });\n\n    this.props.firebase\n      .replies(this.props.prayer.uid)\n      .orderByChild(\"createdAt\")\n      .limitToLast(this.state.limit)\n      .on(\"value\", snapshot => {\n        const replyObject = snapshot.val();\n\n        if (replyObject) {\n          const replyList = Object.keys(replyObject).map(key => ({\n            ...replyObject[key],\n            uid: key\n          }));\n          // convert replies list from snapshot\n\n          this.setState({\n            replies: replyList,\n            loading: false\n          });\n        } else {\n          this.setState({ replies: null, loading: false });\n        }\n      });\n  }\n\n  componentWillUnmount() {\n    this.props.firebase.replies(this.props.prayer.uid).off();\n  }\n\n  onChangeText = event => {\n    this.setState({ text: event.target.value });\n  };\n\n  onChangeCheckbox = event => {\n    this.setState({ [event.target.name]: event.target.checked });\n  };\n\n  onCreateReply = (event, authUser) => {\n    this.props.firebase.replies(this.props.prayer.uid).push({\n      text: this.state.text,\n      prayerId: this.props.prayer.uid,\n      userId: authUser.uid,\n      username: authUser.username,\n      isAnonymous: this.state.isAnonymous,\n      createdAt: this.props.firebase.serverValue.TIMESTAMP\n    });\n\n    this.setState({ text: \"\" });\n\n    event.preventDefault();\n  };\n\n  onEditReply = (reply, text) => {\n    const { uid, ...replySnapshot } = reply;\n\n    this.props.firebase\n      .reply(this.props.prayer.uid)(reply.uid)\n      .set({\n        ...replySnapshot,\n        text,\n        editedAt: this.props.firebase.serverValue.TIMESTAMP\n      });\n  };\n\n  onRemoveReply = uid => {\n    this.props.firebase\n      .reply(this.props.prayer.uid)(uid)\n      .remove();\n  };\n\n  onNextPage = () => {\n    this.setState(\n      state => ({ limit: state.limit + 5 }),\n      this.onListenForReplies\n    );\n  };\n\n  render() {\n    const { text, replies, loading } = this.state;\n\n    const isInvalid = text === \"\";\n\n    return (\n      <AuthUserContext.Consumer>\n        {authUser => (\n          <div>\n            {!loading && replies && (\n              <button type=\"button\" onClick={this.onNextPage}>\n                More\n              </button>\n            )}\n\n            {loading && <div>Loading ...</div>}\n\n            {replies ? (\n              <ReplyList\n                authUser={authUser}\n                replies={replies}\n                onEditReply={this.onEditReply}\n                onRemoveReply={this.onRemoveReply}\n              />\n            ) : (\n              <div>There are no reply requests ...</div>\n            )}\n\n            <form onSubmit={event => this.onCreateReply(event, authUser)}>\n              <input\n                name=\"reply\"\n                type=\"text\"\n                value={text}\n                onChange={this.onChangeText}\n                placeholder=\"Send a reply...\"\n              />\n              <button disabled={isInvalid} type=\"submit\">\n                Send\n              </button>\n            </form>\n          </div>\n        )}\n      </AuthUserContext.Consumer>\n    );\n  }\n}\n\nconst ReplyList = ({ authUser, replies, onEditReply, onRemoveReply }) => (\n  <ul>\n    {replies.map(\n      reply =>\n        (authUser.uid === reply.userId ||\n          !!authUser.roles[ROLES.ADMIN] ||\n          !!authUser.roles[ROLES.MODERATOR]) && (\n          <ReplyItem\n            authUser={authUser}\n            key={reply.uid}\n            reply={reply}\n            onEditReply={onEditReply}\n            onRemoveReply={onRemoveReply}\n          />\n        )\n    )}\n  </ul>\n);\n\nclass ReplyItem extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      editMode: false,\n      editText: this.props.reply.text\n    };\n  }\n\n  onToggleEditMode = () => {\n    this.setState(state => ({\n      editMode: !state.editMode,\n      editText: this.props.reply.text\n    }));\n  };\n\n  onChangeEditText = event => {\n    this.setState({ editText: event.target.value });\n  };\n\n  onSaveEditText = () => {\n    this.props.onEditReply(this.props.reply, this.state.editText);\n\n    this.setState({ editMode: false });\n  };\n\n  render() {\n    const { authUser, reply, onRemoveReply } = this.props;\n    const { editMode, editText } = this.state;\n\n    const isInvalid = editText === \"\";\n\n    return (\n      <li>\n        {editMode ? (\n          <input\n            type=\"text\"\n            value={editText}\n            onChange={this.onChangeEditText}\n          />\n        ) : (\n          <span>\n            <strong>{reply.isAnonymous ? \"Anonymous\" : reply.username}</strong>{\" \"}\n            {reply.text}\n            {console.log(reply)}\n            {reply.editedAt && <span>(Edited)</span>}\n          </span>\n        )}\n        {authUser.uid === reply.userId && (\n          <span>\n            {editMode ? (\n              <span>\n                <button disabled={isInvalid} onClick={this.onSaveEditText}>\n                  Save\n                </button>\n                <button onClick={this.onToggleEditMode}>Reset</button>\n              </span>\n            ) : (\n              <button onClick={this.onToggleEditMode}>Edit</button>\n            )}\n            {!editMode && (\n              <button type=\"button\" onClick={() => onRemoveReply(reply.uid)}>\n                Delete\n              </button>\n            )}\n          </span>\n        )}\n      </li>\n    );\n  }\n}\n\nconst Replies = withFirebase(ReplyBase);\n\nconst condition = authUser =>\n  !!authUser &&\n  (!!authUser.roles[ROLES.ADMIN] ||\n    !!authUser.roles[ROLES.MODERATOR] ||\n    !!authUser.roles[ROLES.APPROVED]);\n\n//or equivalently:\n//const condition = authUser => authUser != null;\n\nexport default withAuthorization(condition)(Replies);\n"]},"metadata":{},"sourceType":"module"}