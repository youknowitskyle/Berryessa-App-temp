{"ast":null,"code":"import _objectWithoutProperties from \"/Users/kyle/workspace/Projects/Berryessa-App/react/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _objectSpread from \"/Users/kyle/workspace/Projects/Berryessa-App/react/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/Users/kyle/workspace/Projects/Berryessa-App/react/src/components/Home/index.js\";\nimport React, { Component } from \"react\";\nimport { compose } from \"recompose\";\nimport { AuthUserContext, withAuthorization, withEmailVerification } from \"../Session\";\nimport { withFirebase } from \"../Firebase\";\nimport * as ROLES from \"../../constants/roles\";\nimport { tsImportEqualsDeclaration } from \"@babel/types\";\n\nconst HomePage = () => React.createElement(\"div\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 14\n  },\n  __self: this\n}, React.createElement(\"h1\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 15\n  },\n  __self: this\n}, \"Home Page\"), React.createElement(\"p\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 16\n  },\n  __self: this\n}, \"You are authenticated.\"), React.createElement(AuthUserContext.Consumer, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 18\n  },\n  __self: this\n}, authUser => React.createElement(\"div\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 20\n  },\n  __self: this\n}, authUser.roles[ROLES.APPROVED] && !authUser.roles[ROLES.PROBATION] ? React.createElement(\"div\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 23\n  },\n  __self: this\n}, React.createElement(\"h2\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 24\n  },\n  __self: this\n}, \"Chat\"), React.createElement(Messages, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 25\n  },\n  __self: this\n})) : React.createElement(\"div\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 28\n  },\n  __self: this\n}, \"You are not allowed to send or view messages. Please contact an administrator to get approved. If you think you have been approved, try logging out and signing back in.\"))), React.createElement(\"br\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 37\n  },\n  __self: this\n}), React.createElement(AuthUserContext.Consumer, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 39\n  },\n  __self: this\n}, authUser => React.createElement(\"div\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 41\n  },\n  __self: this\n}, authUser.roles[ROLES.APPROVED] ? React.createElement(\"div\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 43\n  },\n  __self: this\n}, React.createElement(\"h2\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 44\n  },\n  __self: this\n}, \"Announcements\"), React.createElement(Announcements, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 45\n  },\n  __self: this\n})) : React.createElement(\"div\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 48\n  },\n  __self: this\n}, \"You are not allowed to view announcements yet. Please contact an administrator to get approved. If you think you have been approved, try logging out and signing back in.\"))));\n\nclass AnnouncementsBase extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      title: \"\",\n      text: \"\",\n      loading: false,\n      announcement: []\n    };\n  }\n\n  componentDidMount() {\n    this.setState({\n      loading: true\n    });\n    this.props.firebase.announcements().on(\"value\", snapshot => {\n      const announcementObject = snapshot.val();\n\n      if (announcementObject) {\n        const announcementList = Object.keys(announcementObject).map(key => _objectSpread({}, announcementObject[key], {\n          uid: key\n        }));\n        const filteredAnnouncements = announcementList.filter(item => {\n          return parseInt(item.endDate) > Date.now();\n        });\n        this.setState({\n          announcements: filteredAnnouncements,\n          loading: false\n        });\n      } else {\n        this.setState({\n          announcements: null,\n          loading: false\n        });\n      }\n\n      this.setState({\n        loading: false\n      });\n    });\n  }\n\n  componentWillUnmount() {\n    this.props.firebase.announcements().off();\n  }\n\n  render() {\n    const _this$state = this.state,\n          title = _this$state.title,\n          text = _this$state.text,\n          announcements = _this$state.announcements,\n          loading = _this$state.loading;\n    return React.createElement(AuthUserContext.Consumer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111\n      },\n      __self: this\n    }, authUser => React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }, loading && React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114\n      },\n      __self: this\n    }, \"Loading ...\"), announcements ? React.createElement(AnnouncementList, {\n      authUser: authUser,\n      announcements: announcements,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117\n      },\n      __self: this\n    }) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }, \"There are no announcements...\")));\n  }\n\n}\n\nconst AnnouncementList = ({\n  authUser,\n  announcements\n}) => React.createElement(\"ul\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 132\n  },\n  __self: this\n}, announcements.map(announcement => React.createElement(AnnouncementItem, {\n  authUser: authUser,\n  key: announcement.uid,\n  announcement: announcement,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 134\n  },\n  __self: this\n})));\n\nclass AnnouncementItem extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {};\n  }\n\n  render() {\n    const _this$props = this.props,\n          authUser = _this$props.authUser,\n          announcement = _this$props.announcement;\n    return React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156\n      },\n      __self: this\n    }, React.createElement(\"strong\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157\n      },\n      __self: this\n    }, announcement.title), \" \", announcement.text, \" (Posted by\", \" \", announcement.username, \")\", announcement.editedAt && React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159\n      },\n      __self: this\n    }, \" (Edited) \")));\n  }\n\n}\n\nclass MessagesBase extends Component {\n  constructor(props) {\n    super(props);\n\n    this.onChangeText = event => {\n      this.setState({\n        text: event.target.value\n      });\n    };\n\n    this.onCreateMessage = (event, authUser) => {\n      console.log(this.state.limit);\n      this.props.firebase.messages().push({\n        text: this.state.text,\n        userId: authUser.uid,\n        createdAt: this.props.firebase.serverValue.TIMESTAMP,\n        username: authUser.username\n      });\n      this.setState({\n        text: \"\"\n      });\n      event.preventDefault();\n    };\n\n    this.onRemoveMessage = uid => {\n      this.props.firebase.message(uid).remove();\n    };\n\n    this.onEditMessage = (message, text) => {\n      const uid = message.uid,\n            messageSnapshot = _objectWithoutProperties(message, [\"uid\"]);\n\n      this.props.firebase.message(message.uid).set(_objectSpread({}, messageSnapshot, {\n        text,\n        editedAt: this.props.firebase.serverValue.TIMESTAMP\n      }));\n    };\n\n    this.onMore = () => {\n      this.setState(state => ({\n        limit: state.limit + 5\n      }), this.onListenForMessages);\n    };\n\n    this.state = {\n      text: \"\",\n      loading: false,\n      message: [],\n      limit: 5\n    };\n  }\n\n  componentDidMount() {\n    this.onListenForMessages();\n  }\n\n  onListenForMessages() {\n    this.props.firebase.messages().orderByChild(\"createdAt\").limitToLast(this.state.limit).on(\"value\", snapshot => {\n      const messageObject = snapshot.val();\n\n      if (messageObject) {\n        const messageList = Object.keys(messageObject).map(key => _objectSpread({}, messageObject[key], {\n          uid: key\n        }));\n        this.setState({\n          messages: messageList,\n          loading: false\n        });\n      } else {\n        this.setState({\n          messages: null,\n          loading: false\n        });\n      }\n\n      this.setState({\n        loading: false\n      });\n    });\n  }\n\n  componentWillUnmount() {\n    this.props.firebase.messages().off();\n  }\n\n  render() {\n    const _this$state2 = this.state,\n          text = _this$state2.text,\n          messages = _this$state2.messages,\n          loading = _this$state2.loading;\n    return React.createElement(AuthUserContext.Consumer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256\n      },\n      __self: this\n    }, authUser => React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258\n      },\n      __self: this\n    }, !loading && messages && React.createElement(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      type: \"button\",\n      onClick: this.onMore,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261\n      },\n      __self: this\n    }, \"More\")), loading && React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267\n      },\n      __self: this\n    }, \"Loading ...\"), messages ? React.createElement(MessageList, {\n      authUser: authUser,\n      messages: messages,\n      onEditMessage: this.onEditMessage,\n      onRemoveMessage: this.onRemoveMessage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270\n      },\n      __self: this\n    }) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277\n      },\n      __self: this\n    }, \"There are no messages...\"), React.createElement(\"form\", {\n      onSubmit: event => this.onCreateMessage(event, authUser),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"text\",\n      value: text,\n      onChange: this.onChangeText,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      type: \"submit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282\n      },\n      __self: this\n    }, \"Send\"))));\n  }\n\n}\n\nconst MessageList = ({\n  authUser,\n  messages,\n  onRemoveMessage,\n  onEditMessage\n}) => React.createElement(\"ul\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 297\n  },\n  __self: this\n}, messages.map(message => React.createElement(MessageItem, {\n  authUser: authUser,\n  key: message.uid,\n  message: message,\n  onEditMessage: onEditMessage,\n  onRemoveMessage: onRemoveMessage,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 299\n  },\n  __self: this\n})));\n\nclass MessageItem extends Component {\n  constructor(props) {\n    super(props);\n\n    this.onToggleEditMode = () => {\n      this.setState(state => ({\n        editMode: !state.editMode,\n        editText: this.props.message.text\n      }));\n    };\n\n    this.onChangeEditText = event => {\n      this.setState({\n        editText: event.target.value\n      });\n    };\n\n    this.onSaveEditText = () => {\n      this.props.onEditMessage(this.props.message, this.state.editText);\n      this.setState({\n        editMode: false\n      });\n    };\n\n    this.state = {\n      editMode: false,\n      editText: this.props.message.text\n    };\n  }\n\n  render() {\n    const _this$props2 = this.props,\n          authUser = _this$props2.authUser,\n          message = _this$props2.message,\n          onRemoveMessage = _this$props2.onRemoveMessage;\n    const _this$state3 = this.state,\n          editMode = _this$state3.editMode,\n          editText = _this$state3.editText;\n    const time = new Date(parseInt(message.editedAt)).toUTCString();\n    return React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 344\n      },\n      __self: this\n    }, editMode ? React.createElement(\"input\", {\n      type: \"text\",\n      value: editText,\n      onChange: this.onChangeEditText,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 346\n      },\n      __self: this\n    }) : React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 352\n      },\n      __self: this\n    }, React.createElement(\"strong\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 353\n      },\n      __self: this\n    }, message.username), \" \", message.text, message.editedAt && React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354\n      },\n      __self: this\n    }, \" (Edited at \", time, \") \")), authUser.uid === message.userId && React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 358\n      },\n      __self: this\n    }, editMode ? React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 360\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      onClick: this.onSaveEditText,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 361\n      },\n      __self: this\n    }, \"Save\"), React.createElement(\"button\", {\n      onClick: this.onToggleEditMode,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 362\n      },\n      __self: this\n    }, \"Reset\")) : React.createElement(\"button\", {\n      onClick: this.onToggleEditMode,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 365\n      },\n      __self: this\n    }, \"Edit\"), !editMode && React.createElement(\"button\", {\n      type: \"button\",\n      onClick: () => onRemoveMessage(message.uid),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 369\n      },\n      __self: this\n    }, \"Delete\")));\n  }\n\n}\n\nconst Messages = withFirebase(MessagesBase);\nconst Announcements = withFirebase(AnnouncementsBase);\n\nconst condition = authUser => !!authUser; //or equivalently:\n//const condition = authUser => authUser != null;\n\n\nexport default withAuthorization(condition)(HomePage);","map":{"version":3,"sources":["/Users/kyle/workspace/Projects/Berryessa-App/react/src/components/Home/index.js"],"names":["React","Component","compose","AuthUserContext","withAuthorization","withEmailVerification","withFirebase","ROLES","tsImportEqualsDeclaration","HomePage","authUser","roles","APPROVED","PROBATION","AnnouncementsBase","constructor","props","state","title","text","loading","announcement","componentDidMount","setState","firebase","announcements","on","snapshot","announcementObject","val","announcementList","Object","keys","map","key","uid","filteredAnnouncements","filter","item","parseInt","endDate","Date","now","componentWillUnmount","off","render","AnnouncementList","AnnouncementItem","username","editedAt","MessagesBase","onChangeText","event","target","value","onCreateMessage","console","log","limit","messages","push","userId","createdAt","serverValue","TIMESTAMP","preventDefault","onRemoveMessage","message","remove","onEditMessage","messageSnapshot","set","onMore","onListenForMessages","orderByChild","limitToLast","messageObject","messageList","MessageList","MessageItem","onToggleEditMode","editMode","editText","onChangeEditText","onSaveEditText","time","toUTCString","Messages","Announcements","condition"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { compose } from \"recompose\";\n\nimport {\n  AuthUserContext,\n  withAuthorization,\n  withEmailVerification\n} from \"../Session\";\nimport { withFirebase } from \"../Firebase\";\nimport * as ROLES from \"../../constants/roles\";\nimport { tsImportEqualsDeclaration } from \"@babel/types\";\n\nconst HomePage = () => (\n  <div>\n    <h1>Home Page</h1>\n    <p>You are authenticated.</p>\n\n    <AuthUserContext.Consumer>\n      {authUser => (\n        <div>\n          {authUser.roles[ROLES.APPROVED] &&\n          !authUser.roles[ROLES.PROBATION] ? (\n            <div>\n              <h2>Chat</h2>\n              <Messages />\n            </div>\n          ) : (\n            <div>\n              You are not allowed to send or view messages. Please contact an\n              administrator to get approved. If you think you have been\n              approved, try logging out and signing back in.\n            </div>\n          )}\n        </div>\n      )}\n    </AuthUserContext.Consumer>\n    <br />\n\n    <AuthUserContext.Consumer>\n      {authUser => (\n        <div>\n          {authUser.roles[ROLES.APPROVED] ? (\n            <div>\n              <h2>Announcements</h2>\n              <Announcements />\n            </div>\n          ) : (\n            <div>\n              You are not allowed to view announcements yet. Please contact an\n              administrator to get approved. If you think you have been\n              approved, try logging out and signing back in.\n            </div>\n          )}\n        </div>\n      )}\n    </AuthUserContext.Consumer>\n\n    {/* <div>\n      <h2>Announcements</h2>\n      <Announcements />\n    </div> */}\n  </div>\n);\n\nclass AnnouncementsBase extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      title: \"\",\n      text: \"\",\n      loading: false,\n      announcement: []\n    };\n  }\n\n  componentDidMount() {\n    this.setState({ loading: true });\n\n    this.props.firebase.announcements().on(\"value\", snapshot => {\n      const announcementObject = snapshot.val();\n\n      if (announcementObject) {\n        const announcementList = Object.keys(announcementObject).map(key => ({\n          ...announcementObject[key],\n          uid: key\n        }));\n        const filteredAnnouncements = announcementList.filter(item => {\n          return parseInt(item.endDate) > Date.now();\n        });\n        this.setState({\n          announcements: filteredAnnouncements,\n          loading: false\n        });\n      } else {\n        this.setState({ announcements: null, loading: false });\n      }\n\n      this.setState({ loading: false });\n    });\n  }\n\n  componentWillUnmount() {\n    this.props.firebase.announcements().off();\n  }\n\n  render() {\n    const { title, text, announcements, loading } = this.state;\n\n    return (\n      <AuthUserContext.Consumer>\n        {authUser => (\n          <div>\n            {loading && <div>Loading ...</div>}\n\n            {announcements ? (\n              <AnnouncementList\n                authUser={authUser}\n                announcements={announcements}\n              />\n            ) : (\n              <div>There are no announcements...</div>\n            )}\n          </div>\n        )}\n      </AuthUserContext.Consumer>\n    );\n  }\n}\n\nconst AnnouncementList = ({ authUser, announcements }) => (\n  <ul>\n    {announcements.map(announcement => (\n      <AnnouncementItem\n        authUser={authUser}\n        key={announcement.uid}\n        announcement={announcement}\n      />\n    ))}\n  </ul>\n);\n\nclass AnnouncementItem extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {};\n  }\n\n  render() {\n    const { authUser, announcement } = this.props;\n\n    return (\n      <li>\n        {\n          <span>\n            <strong>{announcement.title}</strong> {announcement.text} (Posted by{\" \"}\n            {announcement.username})\n            {announcement.editedAt && <span> (Edited) </span>}\n          </span>\n        }\n      </li>\n    );\n  }\n}\n\nclass MessagesBase extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      text: \"\",\n      loading: false,\n      message: [],\n      limit: 5\n    };\n  }\n\n  onChangeText = event => {\n    this.setState({ text: event.target.value });\n  };\n\n  onCreateMessage = (event, authUser) => {\n    console.log(this.state.limit);\n\n    this.props.firebase.messages().push({\n      text: this.state.text,\n      userId: authUser.uid,\n      createdAt: this.props.firebase.serverValue.TIMESTAMP,\n      username: authUser.username\n    });\n\n    this.setState({ text: \"\" });\n\n    event.preventDefault();\n  };\n\n  componentDidMount() {\n    this.onListenForMessages();\n  }\n\n  onListenForMessages() {\n    this.props.firebase\n      .messages()\n      .orderByChild(\"createdAt\")\n      .limitToLast(this.state.limit)\n      .on(\"value\", snapshot => {\n        const messageObject = snapshot.val();\n\n        if (messageObject) {\n          const messageList = Object.keys(messageObject).map(key => ({\n            ...messageObject[key],\n            uid: key\n          }));\n          this.setState({\n            messages: messageList,\n            loading: false\n          });\n        } else {\n          this.setState({ messages: null, loading: false });\n        }\n\n        this.setState({ loading: false });\n      });\n  }\n\n  componentWillUnmount() {\n    this.props.firebase.messages().off();\n  }\n\n  onRemoveMessage = uid => {\n    this.props.firebase.message(uid).remove();\n  };\n\n  onEditMessage = (message, text) => {\n    const { uid, ...messageSnapshot } = message;\n\n    this.props.firebase.message(message.uid).set({\n      ...messageSnapshot,\n      text,\n      editedAt: this.props.firebase.serverValue.TIMESTAMP\n    });\n  };\n\n  onMore = () => {\n    this.setState(\n      state => ({ limit: state.limit + 5 }),\n      this.onListenForMessages\n    );\n  };\n\n  render() {\n    const { text, messages, loading } = this.state;\n\n    return (\n      <AuthUserContext.Consumer>\n        {authUser => (\n          <div>\n            {!loading && messages && (\n              <React.Fragment>\n                <button type=\"button\" onClick={this.onMore}>\n                  More\n                </button>\n              </React.Fragment>\n            )}\n\n            {loading && <div>Loading ...</div>}\n\n            {messages ? (\n              <MessageList\n                authUser={authUser}\n                messages={messages}\n                onEditMessage={this.onEditMessage}\n                onRemoveMessage={this.onRemoveMessage}\n              />\n            ) : (\n              <div>There are no messages...</div>\n            )}\n\n            <form onSubmit={event => this.onCreateMessage(event, authUser)}>\n              <input type=\"text\" value={text} onChange={this.onChangeText} />\n              <button type=\"submit\">Send</button>\n            </form>\n          </div>\n        )}\n      </AuthUserContext.Consumer>\n    );\n  }\n}\n\nconst MessageList = ({\n  authUser,\n  messages,\n  onRemoveMessage,\n  onEditMessage\n}) => (\n  <ul>\n    {messages.map(message => (\n      <MessageItem\n        authUser={authUser}\n        key={message.uid}\n        message={message}\n        onEditMessage={onEditMessage}\n        onRemoveMessage={onRemoveMessage}\n      />\n    ))}\n  </ul>\n);\n\nclass MessageItem extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      editMode: false,\n      editText: this.props.message.text\n    };\n  }\n\n  onToggleEditMode = () => {\n    this.setState(state => ({\n      editMode: !state.editMode,\n      editText: this.props.message.text\n    }));\n  };\n\n  onChangeEditText = event => {\n    this.setState({ editText: event.target.value });\n  };\n\n  onSaveEditText = () => {\n    this.props.onEditMessage(this.props.message, this.state.editText);\n\n    this.setState({ editMode: false });\n  };\n\n  render() {\n    const { authUser, message, onRemoveMessage } = this.props;\n    const { editMode, editText } = this.state;\n\n    const time = new Date(parseInt(message.editedAt)).toUTCString();\n\n    return (\n      <li>\n        {editMode ? (\n          <input\n            type=\"text\"\n            value={editText}\n            onChange={this.onChangeEditText}\n          />\n        ) : (\n          <span>\n            <strong>{message.username}</strong> {message.text}\n            {message.editedAt && <span> (Edited at {time}) </span>}\n          </span>\n        )}\n        {authUser.uid === message.userId && (\n          <span>\n            {editMode ? (\n              <span>\n                <button onClick={this.onSaveEditText}>Save</button>\n                <button onClick={this.onToggleEditMode}>Reset</button>\n              </span>\n            ) : (\n              <button onClick={this.onToggleEditMode}>Edit</button>\n            )}\n\n            {!editMode && (\n              <button\n                type=\"button\"\n                onClick={() => onRemoveMessage(message.uid)}\n              >\n                Delete\n              </button>\n            )}\n          </span>\n        )}\n      </li>\n    );\n  }\n}\n\nconst Messages = withFirebase(MessagesBase);\nconst Announcements = withFirebase(AnnouncementsBase);\n\nconst condition = authUser => !!authUser;\n\n//or equivalently:\n//const condition = authUser => authUser != null;\n\nexport default withAuthorization(condition)(HomePage);\n"]},"metadata":{},"sourceType":"module"}